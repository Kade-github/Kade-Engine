# https://github.com/Perkedel/Where_Is_LoadingBar_Functionality/blob/master/.circleci/config.yml
# # https://nakyle.com/godot-ci/
version: 2.1
jobs:
  build:
    machine:
      image: ubuntu-2004:202104-01
    steps:
      - checkout
      - run:
          name: Just check updates & install dependencies
          command: |
            sudo apt-get update
            sudo apt-get -y install wget zip unzip
      - run:
          name: setup Haxe and libraries and built them all
          environment:
            HAXELIB_ROOT: ~/haxelib
            HAXE_INSTALLDIR: $HOME/haxe
          command: |
            cd ~
            sudo add-apt-repository ppa:haxe/releases -y
            sudo apt update
            sudo apt install build-essential -y
            sudo apt-get install gcc-multilib g++-multilib -y
            sudo apt install neko tar -y
            wget https://github.com/HaxeFoundation/haxe/releases/download/4.1.5/haxe-4.1.5-linux64.tar.gz
            mkdir -p $HAXE_INSTALLDIR
            tar -xf haxe-4.1.5-linux64.tar.gz -C $HAXE_INSTALLDIR
            export PATH=$PATH:$HAXE_INSTALLDIR/haxe_20201231082044_5e33a78aa
            mkdir -p $HAXELIB_ROOT && haxelib setup $HAXELIB_ROOT
            haxelib install lime 7.9.0
            haxelib install openfl
            haxelib install flixel
            haxelib run lime setup flixel -y
            haxelib run lime setup -y
            haxelib install flixel-tools
            haxelib install flixel-addons
            haxelib install flixel-ui
            haxelib install hscript
            haxelib install newgrounds
            haxelib git faxe https://github.com/uhrobots/faxe
            haxelib git polymod https://github.com/larsiusprime/polymod.git
            haxelib git discord_rpc https://github.com/Aidan63/linc_discord-rpc
            haxelib install linc_luajit
            haxelib install actuate
            haxelib git extension-webm https://github.com/GrowtopiaFli/extension-webm
            haxelib list
            pwd
            ls
            echo ha hi ha hu huha
            haxelib run lime rebuild extension-webm linux
            haxelib run lime rebuild linc_luajit linux # JOELwindows7: because it seems it only had windows?
            cd ~/projects/kaded-fnf-mods
            haxelib run lime build linux
            tar -cvf last-funkin-moments-linux.tar -C ~/projects/kaded-fnf-mods/export/release/linux/bin
            haxelib run lime build html5
            tar -cvf last-funkin-moments-html5.tar -C ~/projects/kaded-fnf-mods/export/release/html5/bin
            haxelib run lime build windows
            zip -r last-funkin-moments-windows.zip ~/projects/kaded-fnf-mods/export/release/windows/bin
            haxelib run lime build mac
            tar -cvf last-funkin-moments-mac.tar -C ~/projects/kaded-fnf-mods/export/release/macos/bin

      # - run:
      #     name: Rebuild GrowtopiaFli video cutsceners
      #     command: |
      #       haxelib run lime rebuild extension-webm linux
      # - run:
      #     name: Just build this game already Linux
      #     command: |
      #       cd ~/projects/kaded-fnf-mods
      #       haxelib run lime build linux
      #       tar -cvf last-funkin-moments-linux.tar -C ~/projects/kaded-fnf-mods/export/release/linux/bin
      # - run:
      #     name: Just build this game already Windows
      #     command: |
      #       cd ~/projects/kaded-fnf-mods
      #       haxelib run lime build windows
      #       zip -r last-funkin-moments-windows.zip ~/projects/kaded-fnf-mods/export/release/windows/bin
      # - run:
      #     name: Just build this game already macOS
      #     command: |
      #       cd ~/projects/kaded-fnf-mods
      #       haxelib run lime build mac
      #       tar -cvf last-funkin-moments-mac.tar -C ~/projects/kaded-fnf-mods/export/release/macos/bin
      # - run:
      #     name: Just build this game already HTML5
      #     command: |
      #       cd ~/projects/kaded-fnf-mods
      #       haxelib run lime build html5
      #       tar -cvf last-funkin-moments-html5.tar -C ~/projects/kaded-fnf-mods/export/release/html5/bin
      # ########## unfortunately that each run did not recognize each other

